<!DOCTYPE html>
<html lang="fr-CA">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ma bulle de recommandation</title>
<style>
body{margin:0;padding:0;font-family:Verdana,sans-serif;background:linear-gradient(to bottom,#5bc0eb,#20639b);height:100vh;overflow:hidden;position:relative;opacity:0;animation:fadeIn .5s ease forwards}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes fadeOut{from{opacity:1}to{opacity:0}}
.fade-out{animation:fadeOut .5s ease forwards}
.container{display:flex;justify-content:center;align-items:center;height:100%;padding:2rem;box-sizing:border-box;position:relative;z-index:1}
.data-panel{background:rgba(255,255,255,.1);border-radius:8px;padding:1rem;color:#fff;overflow-y:auto;margin:auto;width:80%;max-width:500px;text-align:center}
.nav-bubble{position:absolute;top:1rem;width:30px;height:30px;background:rgba(255,255,255,.2);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;backdrop-filter:blur(6px);transition:background .2s;z-index:2;color:#fff;font-size:1rem}
.nav-bubble:hover{background:rgba(255,255,255,.3)}
.nav-left{right:70px}
.nav-right{right:20px}
#trainBtn{background:rgba(255,255,255,.2);border:none;border-radius:4px;padding:.6rem 1.2rem;cursor:pointer;backdrop-filter:blur(6px);color:#fff;font-size:1rem;transition:background .2s;outline:none;margin:1rem 0}
#trainBtn:hover:not(:disabled){background:rgba(255,255,255,.3)}
#trainBtn:disabled{opacity:.5;cursor:default}
table{width:100%;border-collapse:collapse;margin:1rem 0}
th,td{border:1px solid rgba(255,255,255,.3);padding:.5rem;text-align:center}
th{background:rgba(255,255,255,.2)}
.bubble-floating{position:absolute;border-radius:50%;background:rgba(255,255,255,.1);animation:floatUp 30s linear infinite;pointer-events:none;backdrop-filter:blur(8px);z-index:0}
@keyframes floatUp{0%{bottom:-100px;transform:translateX(0)}100%{bottom:110%;transform:translateX(50px)}}
</style>
</head>
<body>
<div class="nav-bubble nav-left" onclick="navigate('page3.html')">◀</div>
<div class="nav-bubble nav-right" onclick="navigate('page5.html')">▶</div>
<div class="bubble-floating" style="left:10%;width:80px;height:80px;animation-delay:1s"></div>
<div class="bubble-floating" style="left:30%;width:60px;height:60px;animation-delay:5s"></div>
<div class="bubble-floating" style="left:50%;width:100px;height:100px;animation-delay:3s"></div>
<div class="bubble-floating" style="left:70%;width:50px;height:50px;animation-delay:7s"></div>
<div class="bubble-floating" style="left:90%;width:80px;height:80px;animation-delay:4s"></div>
<div class="container">
  <div class="data-panel">
    <h2>Entraînement</h2>
    <div>
      <label>λ Popularité: <span id="lambdaVal"></span></label>
      <input id="lambdaSlider" type="range" min="0" max="1" step="0.01">
    </div>
    <div>
      <label>k : <span id="kVal"></span></label>
      <input id="kSlider" type="range" min="1" max="5" step="1">
    </div>
    <button id="trainBtn">Appuyer ici pour entraîner le modèle</button>
    <div id="status">Prêt</div>
    <div id="results"></div>
  </div>

</div>
<script type="module">

import * as rec from './rec.js';

function navigate(u){
 document.body.classList.add('fade-out');
 const dest=u+location.hash;
 document.body.addEventListener('animationend',()=>location.href=dest,{once:true});
}

const lambdaSlider=document.getElementById('lambdaSlider');
const kSlider=document.getElementById('kSlider');
const lambdaVal=document.getElementById('lambdaVal');
const kVal=document.getElementById('kVal');
const savedSettings=JSON.parse(localStorage.getItem('settings')||'{}');
lambdaSlider.value=savedSettings.lambdaPopularity??0.5;
kSlider.value=savedSettings.k??3;
function persistSettings(){
 const s={lambdaPopularity:parseFloat(lambdaSlider.value),k:parseInt(kSlider.value)};
 lambdaVal.textContent=s.lambdaPopularity.toFixed(2);
 kVal.textContent=s.k;
 localStorage.setItem('settings',JSON.stringify(s));
}
lambdaSlider.addEventListener('input',persistSettings);
kSlider.addEventListener('input',persistSettings);
persistSettings();
document.getElementById('trainBtn').addEventListener('click',()=>{
 const cleanData=JSON.parse(localStorage.getItem('videosClean')||'[]');
 if(cleanData.length===0){
  document.getElementById('status').textContent='Aucune donnée';
  return;
 }
 document.getElementById('trainBtn').disabled=true;
 document.getElementById('status').textContent='Entraînement...';
 setTimeout(()=>{
  const settings={lambdaPopularity:parseFloat(lambdaSlider.value),k:parseInt(kSlider.value)};
  const {model,metrics}=rec.train(cleanData,settings);
  localStorage.setItem('trainedModel',JSON.stringify(model));
  localStorage.setItem('settings',JSON.stringify(settings));
  let res='<h3>Résultats</h3><table><tr><th>Métrique</th><th>Valeur</th></tr>';
  res+=`<tr><td>Précision</td><td>${metrics.precision.toFixed(2)}</td></tr>`;
  res+=`<tr><td>Rappel</td><td>${metrics.recall.toFixed(2)}</td></tr>`;
  res+=`<tr><td>Diversité</td><td>${metrics.diversity.toFixed(2)}</td></tr>`;
  res+='</table>';
  document.getElementById('results').innerHTML=res;
  document.getElementById('status').textContent='Terminé';
  document.getElementById('trainBtn').disabled=false;
 },100);
});

</script>

</body>
</html>
