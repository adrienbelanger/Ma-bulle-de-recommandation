<!DOCTYPE html>
<html lang="fr-CA">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ma bulle de recommandation</title>
<style>
body{margin:0;padding:0;font-family:Verdana,sans-serif;background:linear-gradient(to bottom,#5bc0eb,#20639b);height:100vh;overflow:hidden;position:relative;opacity:0;animation:fadeIn .5s ease forwards}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes fadeOut{from{opacity:1}to{opacity:0}}
.fade-out{animation:fadeOut .5s ease forwards}
.container{display:flex;justify-content:center;align-items:center;height:100%;padding:2rem;box-sizing:border-box;position:relative;z-index:1}
.data-panel{background:rgba(255,255,255,.1);border-radius:8px;padding:1rem;color:#fff;overflow-y:auto;margin:auto;width:80%;max-width:500px;text-align:center}
.nav-bubble{position:absolute;top:1rem;width:30px;height:30px;background:rgba(255,255,255,.2);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;backdrop-filter:blur(6px);transition:background .2s;z-index:2;color:#fff;font-size:1rem}
.nav-bubble:hover{background:rgba(255,255,255,.3)}
.nav-left{right:70px}
.nav-right{right:20px}
#trainBtn{background:rgba(255,255,255,.2);border:none;border-radius:4px;padding:.6rem 1.2rem;cursor:pointer;backdrop-filter:blur(6px);color:#fff;font-size:1rem;transition:background .2s;outline:none;margin:1rem 0}
#trainBtn:hover:not(:disabled){background:rgba(255,255,255,.3)}
#trainBtn:disabled{opacity:.5;cursor:default}
table{width:100%;border-collapse:collapse;margin:1rem 0}
th,td{border:1px solid rgba(255,255,255,.3);padding:.5rem;text-align:center}
th{background:rgba(255,255,255,.2)}
.bubble-floating{position:absolute;border-radius:50%;background:rgba(255,255,255,.1);animation:floatUp 30s linear infinite;pointer-events:none;backdrop-filter:blur(8px);z-index:0}
@keyframes floatUp{0%{bottom:-100px;transform:translateX(0)}100%{bottom:110%;transform:translateX(50px)}}
</style>
</head>
<body>
<div class="nav-bubble nav-left" onclick="navigate('page3.html')">◀</div>
<div class="nav-bubble nav-right" onclick="navigate('page5.html')">▶</div>
<div class="bubble-floating" style="left:10%;width:80px;height:80px;animation-delay:1s"></div>
<div class="bubble-floating" style="left:30%;width:60px;height:60px;animation-delay:5s"></div>
<div class="bubble-floating" style="left:50%;width:100px;height:100px;animation-delay:3s"></div>
<div class="bubble-floating" style="left:70%;width:50px;height:50px;animation-delay:7s"></div>
<div class="bubble-floating" style="left:90%;width:80px;height:80px;animation-delay:4s"></div>
<div class="container">
  <div class="data-panel">
    <h2>Entraînement</h2>
    <button id="trainBtn">Appuyer ici pour entraîner le modèle</button>
    <div id="status">Prêt</div>
    <div id="results"></div>
  </div>
</div>
<script>
function navigate(u){
 document.body.classList.add('fade-out');
 document.body.addEventListener('animationend',()=>location.href=u,{once:true})
}
function tokens(s){return s.toLowerCase().split(/[^a-zàâçéèêëîïôûùüÿñæœ]+/).filter(Boolean)}
const STORAGE_KEY='studentDataV2';
const BASE_SAMPLES=[
{title:'Aventure au chalet des amis',label:'Dessins'},
{title:'Moments drôles du castor bleu',label:'Dessins'},
{title:'La course folle du lapin malin',label:'Dessins'},
{title:'La flaque de boue magique',label:'Dessins'},
{title:'Le coureur et le coyote rigolo',label:'Dessins'},
{title:'Blagues du duo farceur',label:'Dessins'},
{title:'Sauvetage dans la forêt mystique',label:'Dessins'},
{title:'Patrouille du port joyeux',label:'Dessins'},
{title:'Fête de danse des chiots',label:'Dessins'},
{title:'La montagne russe bricolée',label:'Dessins'},
{title:'Le village en carton prend vie',label:'Dessins'},
{title:'Le dragon qui éternue des confettis',label:'Dessins'},
{title:'La fusée dessinée décolle pour de vrai',label:'Dessins'},
{title:'Le carnaval des parapluies volants',label:'Dessins'},
{title:'La carte au trésor de la cour d’école',label:'Dessins'},
{title:'Le train fantôme mais gentil',label:'Dessins'},
{title:'Le concours de grimaces intergalactique',label:'Dessins'},
{title:'Le cirque des objets perdus',label:'Dessins'},
{title:'Le pâtissier pingouin et ses gâteaux',label:'Dessins'},
{title:'La cabane secrète au sommet du nuage',label:'Dessins'},

{title:'Volcan maison avec vinaigre',label:'Expériences'},
{title:'Fusée au bicarbonate de soude',label:'Expériences'},
{title:'Réaction pâte à dents géante',label:'Expériences'},
{title:'Fabriquer du slime étirable',label:'Expériences'},
{title:'Lait qui change de couleur',label:'Expériences'},
{title:'Oobleck étrange liquide-solide',label:'Expériences'},
{title:'Voiture ballon propulsée',label:'Expériences'},
{title:'Lampe lave DIY',label:'Expériences'},
{title:'Pile citron maison',label:'Expériences'},
{title:'Fontaine menthe et cola',label:'Expériences'},
{title:'Arc-en-ciel en bocal',label:'Expériences'},
{title:'Encre invisible au jus de citron',label:'Expériences'},
{title:'Pont en spaghetti qui tient',label:'Expériences'},
{title:'Bateau en aluminium qui ne coule pas',label:'Expériences'},
{title:'Aimants et boussole maison',label:'Expériences'},
{title:'Pluie en nuage de mousse à raser',label:'Expériences'},
{title:'Paper rocket qui vole droit',label:'Expériences'},
{title:'Œuf rebondissant sans coquille',label:'Expériences'},
{title:'Cristaux de sel en 24 heures',label:'Expériences'},
{title:'Tornade dans une bouteille',label:'Expériences'},

{title:'Premiers pas du panda roux',label:'Animaux'},
{title:'Safari rugissements du lion',label:'Animaux'},
{title:'Chiens exécutent des tours',label:'Animaux'},
{title:'Chatons jouent au laser',label:'Animaux'},
{title:'Sauts spectaculaires des dauphins',label:'Animaux'},
{title:'Danse des oiseaux tropicaux',label:'Animaux'},
{title:'Vie secrète des fourmis',label:'Animaux'},
{title:'Sauvetage d’un manchot',label:'Animaux'},
{title:'Bain de boue de l’éléphant',label:'Animaux'},
{title:'Grimpe du panda roux',label:'Animaux'},
{title:'Comment brosser son chat sans stress',label:'Animaux'},
{title:'Mon chien teste un parcours d’agilité',label:'Animaux'},
{title:'Au refuge: histoires de chiens seniors',label:'Animaux'},
{title:'Chevaux miniatures en promenade',label:'Animaux'},
{title:'Caméra nichoir: naissance des mésanges',label:'Animaux'},
{title:'Renard curieux près du chalet',label:'Animaux'},
{title:'Grenouilles et têtards à l’étang',label:'Animaux'},
{title:'Tortues marines libérées sur la plage',label:'Animaux'},
{title:'Au bain: capybaras relax',label:'Animaux'},
{title:'Guide des soins pour hamster débutant',label:'Animaux'},

{title:'Le système solaire expliqué',label:'Sciences'},
{title:'Pourquoi les plantes sont vertes',label:'Sciences'},
{title:'Physique des montagnes russes',label:'Sciences'},
{title:'Voyage dans le corps humain',label:'Sciences'},
{title:'Construire un circuit simple',label:'Sciences'},
{title:'Cycle de l’eau illustré',label:'Sciences'},
{title:'Bases du magnétisme',label:'Sciences'},
{title:'Les états de la matière',label:'Sciences'},
{title:'Documentaire sur les dinosaures',label:'Sciences'},
{title:'Introduction à l’électricité',label:'Sciences'},
{title:'Pourquoi avons-nous des saisons',label:'Sciences'},
{title:'Énergie renouvelable à la maison',label:'Sciences'},
{title:'Comment les avions volent',label:'Sciences'},
{title:'La force de gravité en exemples',label:'Sciences'},
{title:'Microbes bons et mauvais',label:'Sciences'},
{title:'Lumière et prisme arc-en-ciel',label:'Sciences'},
{title:'Anatomie du cerveau simplifiée',label:'Sciences'},
{title:'Tectonique des plaques animée',label:'Sciences'},
{title:'Pourquoi le ciel est bleu',label:'Sciences'},
{title:'Mesurer le temps sans montre',label:'Sciences'},

{title:'Construction d’un monde en blocs',label:'Jeux vidéo'},
{title:'Match de soccer virtuel',label:'Jeux vidéo'},
{title:'Aventure RPG forêt enchantée',label:'Jeux vidéo'},
{title:'Stratégie conquête médiévale',label:'Jeux vidéo'},
{title:'Puzzle plateforme spatiale',label:'Jeux vidéo'},
{title:'Course à obstacles néon',label:'Jeux vidéo'},
{title:'Simulation ferme canadienne',label:'Jeux vidéo'},
{title:'Course folle de kart arctique',label:'Jeux vidéo'},
{title:'Défi danse rythmique arcade',label:'Jeux vidéo'},
{title:'Guide débutant de l’île pixel',label:'Jeux vidéo'},
{title:'Survie extrême : ma base secrète révélée',label:'Jeux vidéo'},
{title:'Top 5 des meilleurs RPG fantastiques',label:'Jeux vidéo'},
{title:'Jeu d’énigmes: salle secrète',label:'Jeux vidéo'},
{title:'Boss final battu sans dégâts',label:'Jeux vidéo'},
{title:'Construire une ferme automatique',label:'Jeux vidéo'},
{title:'Vitesse: record sur piste urbaine',label:'Jeux vidéo'},
{title:'Mode créatif: maison moderne',label:'Jeux vidéo'},
{title:'Tournoi local: finale épique',label:'Jeux vidéo'},
{title:'Astuces pour débuter en sandbox',label:'Jeux vidéo'},
{title:'Exploration d’un donjon gelé',label:'Jeux vidéo'}
];

function normalizeSample(s){
  if(!s) return null;
  const title=(s.title||s.watched||'').trim();
  const label=(s.label||s.category||'').trim();
  if(!title||!label) return null;
  return {title,label,source:s.source||'unknown'};
}
function loadSamples(){
  try{
    const raw=JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');
    const stored=Array.isArray(raw)?raw.map(normalizeSample).filter(Boolean):[];
    return dedupeSamples(BASE_SAMPLES.concat(stored));
  }catch(e){
    return BASE_SAMPLES;
  }
}
function dedupeSamples(arr){
  const seen=new Set(); const out=[];
  (arr||[]).forEach(s=>{
    if(!s) return;
    const key=s.title.toLowerCase()+'|'+s.label.toLowerCase();
    if(seen.has(key)) return;
    seen.add(key);
    out.push({title:s.title,label:s.label,source:s.source||'unknown'});
  });
  return out;
}

function trainNaiveBayes(samples){
  const vocab=new Map();
  const labelCounts={}, wordCounts={}, totalWords={};
  samples.forEach(s=>{
    const tokensArr=tokens(s.title);
    labelCounts[s.label]=(labelCounts[s.label]||0)+1;
    wordCounts[s.label]=wordCounts[s.label]||{};
    totalWords[s.label]=totalWords[s.label]||0;
    tokensArr.forEach(w=>{
      vocab.set(w,(vocab.get(w)||0)+1);
      wordCounts[s.label][w]=(wordCounts[s.label][w]||0)+1;
      totalWords[s.label]++;
    });
  });
  const labels=Object.keys(labelCounts);
  const vocabSize=vocab.size||1;
  const logPrior={}; const logLik={}; const unk={};
  labels.forEach(l=>{
    logPrior[l]=Math.log((labelCounts[l]||1)/samples.length);
    logLik[l]={};
    const denom=(totalWords[l]||0)+vocabSize;
    unk[l]=Math.log(1/denom);
    vocab.forEach((_,w)=>{
      const num=(wordCounts[l][w]||0)+1;
      logLik[l][w]=Math.log(num/denom);
    });
  });
  return {labels,logPrior,logLik,unk,vocab:Array.from(vocab.keys())};
}
function predictWithModel(text,model){
  if(!model||!model.labels.length) return null;
  const toks=tokens(text);
  let best=null,bestScore=-Infinity;
  model.labels.forEach(l=>{
    let s=model.logPrior[l];
    toks.forEach(w=>{
      s+= (model.logLik[l][w]!==undefined?model.logLik[l][w]:model.unk[l]);
    });
    if(s>bestScore){bestScore=s;best=l;}
  });
  return best;
}

document.getElementById('trainBtn').addEventListener('click',()=>{
  const btn=document.getElementById('trainBtn');
  const status=document.getElementById('status');
  const results=document.getElementById('results');
  btn.disabled=true;
  status.textContent='Entraînement...';
  setTimeout(()=>{
    const samples=loadSamples();
    if(!samples.length){
      status.textContent='Aucune donnée pour entraîner.';
      btn.disabled=false;
      return;
    }
    const model=trainNaiveBayes(samples);
    status.textContent='Évaluation rapide...';
    let correct=0;
    samples.forEach(s=>{
      const pred=predictWithModel(s.title,model);
      if(pred===s.label) correct++;
    });
    const acc=Math.round((correct/Math.max(samples.length,1))*100);
    let res='<h3>Résultats</h3>';
    res+=`<p>${samples.length} échantillons (page 1 + page 2 + base), précision entraînement: <strong>${acc}%</strong></p>`;
    res+='<table><tr><th>Titre</th><th>Vérité</th><th>Prédiction</th></tr>';
    samples.slice(0,12).forEach(s=>{
      const pred=predictWithModel(s.title,model);
      const ok=pred===s.label?'✅':'❌';
      res+=`<tr><td>${s.title}</td><td>${s.label}</td><td>${pred||'?'} ${ok}</td></tr>`;
    });
    res+='</table>';
    results.innerHTML=res;
    status.textContent='Terminé';
    btn.disabled=false;
  },400);
});
</script>
</body>
</html>
