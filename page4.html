<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ma bulle de recommandation - TensorFlow.js</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.13.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { margin:0; padding:0; font-family: Verdana, sans-serif; background: linear-gradient(to bottom, #5bc0eb, #20639b); height:100vh; overflow:hidden; position:relative; opacity:0; animation:fadeIn 0.5s ease forwards; }
    @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
    @keyframes fadeOut { from{opacity:1;} to{opacity:0;} }
    .fade-out{animation:fadeOut 0.5s ease forwards;}
    .container{display:flex; height:100%; padding:1rem; box-sizing:border-box; position:relative; z-index:1; gap:1rem;}
    .panel{flex:1; background:rgba(255,255,255,0.1); border-radius:8px; padding:1rem; color:#fff; overflow:auto;}
    h2{margin-top:0; font-size:1.3rem;}
    input[type=range]{width:100%;}
    .nav-bubble{position:absolute; top:1rem; width:30px; height:30px; background:rgba(255,255,255,0.2); border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; backdrop-filter:blur(6px); transition:background 0.2s; z-index:2; color:#fff; font-size:1rem;}
    .nav-bubble:hover{background:rgba(255,255,255,0.3);}
    .nav-left{right:70px;}
    .nav-right{right:20px;}
    .bubble-floating{position:absolute; border-radius:50%; background:rgba(255,255,255,0.1); animation:floatUp 30s linear infinite; pointer-events:none; backdrop-filter:blur(8px); z-index:0;}
    @keyframes floatUp{0%{bottom:-100px;transform:translateX(0);}100%{bottom:110%;transform:translateX(50px);}}
  </style>
</head>
<body>
  <div class="nav-bubble nav-left" onclick="navigate('page3.html')">◀</div>
  <div class="nav-bubble nav-right" onclick="navigate('page5.html')">▶</div>
  <div class="container">
    <div class="panel">
      <h2>Entraînement</h2>
      <input type="range" id="epoch-slider" min="1" max="50" value="10"/>
      <div>Époques : <span id="epoch-val">10</span></div>
      <button id="train-btn">Lancer</button>
      <div id="accuracy">Accuracy : -</div>
    </div>
    <div class="panel">
      <h2>Loss</h2>
      <canvas id="lossChart" height="200"></canvas>
    </div>
  </div>
  <div class="bubble-floating" style="left:10%;width:80px;height:80px;animation-delay:1s;"></div>
  <div class="bubble-floating" style="left:30%;width:60px;height:60px;animation-delay:5s;"></div>
  <div class="bubble-floating" style="left:50%;width:100px;height:100px;animation-delay:3s;"></div>
  <div class="bubble-floating" style="left:70%;width:50px;height:50px;animation-delay:7s;"></div>
  <div class="bubble-floating" style="left:90%;width:80px;height:80px;animation-delay:4s;"></div>
  <script>
    function navigate(url){
      document.body.classList.add('fade-out');
      document.body.addEventListener('animationend',()=>window.location.href=url,{once:true});
    }
    const titles=['Découverte d’un monde de blocs','Exploration d’un jeu d’énigmes','Recette de crêpes express','Tutoriel sur la préparation de smoothies','Présentation des tendances mode été','Interview d’un créateur de mode','Mon chat apprend un nouveau tour','Top 10 des animaux mignons','Test d’un nouveau jeu de sport','Vlog : ma journée sportive'];
    const categories=['Gaming','Gaming','Cuisine','Cuisine','Mode','Mode','Animaux','Animaux','Sport','Sport'];
    const dataset=[];
    for(let i=0;i<50;i++){const idx=i%titles.length;dataset.push({age:10+(i%5),titleIndex:idx,category:categories[idx]});}
    const epochSlider=document.getElementById('epoch-slider');
    const epochVal=document.getElementById('epoch-val');
    epochSlider.oninput=()=>epochVal.textContent=epochSlider.value;
    let lineChart;
    function prepareData(){
      const shuffled=[...dataset].sort(()=>Math.random()-0.5);
      const split=Math.floor(shuffled.length*0.8);
      const train=shuffled.slice(0,split);
      const test=shuffled.slice(split);
      const catList=[...new Set(categories)];
      const labelMap={};catList.forEach((c,i)=>labelMap[c]=i);
      const toTensors=data=>{
        const xs=data.map(d=>[d.age,d.titleIndex]);
        const ys=data.map(d=>labelMap[d.category]);
        return {x:tf.tensor2d(xs),y:tf.tensor1d(ys,'int32')};
      };
      const {x:trainX,y:trainY}=toTensors(train);
      const {x:testX,y:testY}=toTensors(test);
      return {trainX,trainY,testX,testY,numClasses:catList.length};
    }
    async function trainModel(){
      const epochs=parseInt(epochSlider.value);
      const {trainX,trainY,testX,testY,numClasses}=prepareData();
      const model=tf.sequential();
      model.add(tf.layers.dense({inputShape:[2],units:8,activation:'relu'}));
      model.add(tf.layers.dense({units:numClasses,activation:'softmax'}));
      model.compile({optimizer:'adam',loss:'sparseCategoricalCrossentropy',metrics:['accuracy']});
      const losses=[];
      await model.fit(trainX,trainY,{
        epochs,
        validationData:[testX,testY],
        callbacks:{onEpochEnd:(epoch,logs)=>{
          losses.push({epoch:epoch+1,loss:logs.loss});
          const labels=losses.map(l=>l.epoch);
          const data=losses.map(l=>l.loss);
          if(lineChart) lineChart.destroy();
          lineChart=new Chart(document.getElementById('lossChart'),{type:'line',data:{labels,datasets:[{label:'Loss',data,borderColor:'#fff',fill:false}]},options:{scales:{y:{beginAtZero:true}}}});
        }}
      });
      const evalRes=await model.evaluate(testX,testY);
      const acc=await evalRes[1].data();
      document.getElementById('accuracy').textContent=`Accuracy : ${(acc[0]*100).toFixed(1)}%`;
      window.trainedModel=model;
    }
    document.getElementById('train-btn').onclick=trainModel;
  </script>
</body>
</html>
